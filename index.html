<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Micro Tetris</title>
<link rel="icon" type="image/png" href="favicon.png">
<style>
  :root {
    --bg:#0b1220; --panel:#0f1724; --accent:#00d1ff; --muted:#9aa4b2; --glass: rgba(255,255,255,0.03);
    --cell:28px;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  body{
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;
    background:linear-gradient(180deg,#041022,#08122a);
    color:#e8f5ff;
    display:flex;min-height:100vh;align-items:center;justify-content:center;
    padding:20px;
  }
  .wrap{display:flex;gap:20px;align-items:flex-start;flex-wrap:wrap;justify-content:center;}
  .board-panel,.info{
    background:var(--panel);padding:18px;border-radius:12px;
    border:1px solid var(--glass);box-shadow:0 10px 30px rgba(2,6,23,0.6);
  }
  canvas{
    display:block;background:linear-gradient(180deg,#071226,#042135);
    border-radius:6px;image-rendering:pixelated;
    width:100%;height:auto;max-width:280px;
  }
  .info{width:260px;flex-shrink:0}
  h1{margin:0 0 6px 0;font-size:18px;text-align:center;}
  .muted{color:var(--muted);font-size:13px;text-align:center;}
  .stat{display:flex;justify-content:space-between;margin:8px 0;font-weight:600}
  .next{width:var(--cell);height:calc(var(--cell)*4);background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);
    display:flex;align-items:center;justify-content:center;border-radius:6px;margin:8px auto;padding:6px;}
  .controls{font-size:13px;color:var(--muted);margin-top:10px;text-align:center;}
  button{
    background:var(--accent);color:#031022;border:0;padding:8px 12px;
    border-radius:8px;font-weight:700;cursor:pointer;transition:0.15s;
  }
  button:active{transform:scale(0.95);}
  .row{display:flex;gap:8px;align-items:center;justify-content:space-between;}
  footer{margin-top:12px;font-size:12px;color:var(--muted);text-align:center;}
  .small{font-size:12px;color:var(--muted);}
  /* touch controls */
  #touch-controls{display:none;margin-top:10px;text-align:center;}
  #touch-controls button{
    background:var(--accent);color:#031022;border:0;padding:12px 18px;margin:4px;
    border-radius:8px;font-weight:700;cursor:pointer;font-size:18px;
  }
  @media(max-width:600px){
    :root{--cell:22px;}
    body{padding:10px;}
    .info{display:none;}
    h1{font-size:20px;}
    .wrap{flex-direction:column;align-items:center;}
    #touch-controls{display:block;}
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="board-panel">
      <h1>Micro Tetris</h1>
      <div class="muted">Play, clear lines, level up!</div>
      <div style="height:12px"></div>
      <canvas id="board" width="280" height="560"></canvas>
      <div style="height:10px"></div>
      <div class="row">
        <div class="small">Score: <span id="score">0</span></div>
        <div class="small">Level: <span id="level">1</span></div>
        <div class="small">Lines: <span id="lines">0</span></div>
      </div>
      <div style="height:10px"></div>
      <div class="row" style="justify-content:center;gap:10px;">
        <button id="pauseBtn">Pause (P)</button>
        <button id="restartBtn">Restart (R)</button>
      </div>

      <!-- on-screen touch controls -->
      <div id="touch-controls">
        <button onclick="microTetris.left()">←</button>
        <button onclick="microTetris.rotate()">⟳</button>
        <button onclick="microTetris.right()">→</button>
        <button onclick="microTetris.drop()">↓</button>
      </div>
    </div>

    <aside class="info">
      <div style="text-align:center;">
        <div style="font-weight:700">Next</div>
        <div class="muted">Preview upcoming tetromino</div>
      </div>
      <div class="next"><canvas id="next" width="112" height="112" style="image-rendering:pixelated"></canvas></div>
      <div class="muted" style="text-align:center;">Controls</div>
      <div class="controls">
        ← / → : move<br>↑ : rotate<br>↓ : soft drop<br>Space : hard drop<br>P : pause<br>R : restart
      </div>
      <footer>Made for quick fun — push updates to your repo to iterate!</footer>
    </aside>
  </div>

<script>
(() => {
  const COLS=10, ROWS=20, CELL=28;
  const canvas=document.getElementById('board'),ctx=canvas.getContext('2d');ctx.imageSmoothingEnabled=false;
  const nextCanvas=document.getElementById('next'),nctx=nextCanvas.getContext('2d');nctx.imageSmoothingEnabled=false;
  const scoreEl=document.getElementById('score'),levelEl=document.getElementById('level'),linesEl=document.getElementById('lines'),
        pauseBtn=document.getElementById('pauseBtn'),restartBtn=document.getElementById('restartBtn');
  const COLORS=[null,'#00f0f0','#0000f0','#f0a000','#f0f000','#00f000','#a000f0','#f00000'];
  const TETROMINOS={
    1:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],
    2:[[2,0,0],[2,2,2],[0,0,0]],
    3:[[0,0,3],[3,3,3],[0,0,0]],
    4:[[4,4],[4,4]],
    5:[[0,5,5],[5,5,0],[0,0,0]],
    6:[[0,6,0],[6,6,6],[0,0,0]],
    7:[[7,7,0],[0,7,7],[0,0,0]]
  };
  let arena=createMatrix(COLS,ROWS);
  let player={pos:{x:0,y:0},matrix:null,next:null,score:0};
  let dropCounter=0,dropInterval=800,lastTime=0,isPaused=false,totalLines=0,level=1;

  function createMatrix(w,h){return Array.from({length:h},()=>Array(w).fill(0));}
  function drawCell(x,y,color){const px=x*CELL,py=y*CELL;ctx.fillStyle=color;ctx.fillRect(px+1,py+1,CELL-2,CELL-2);}
  function drawMatrix(m,o){m.forEach((r,y)=>r.forEach((v,x)=>v&&drawCell(x+o.x,y+o.y,COLORS[v])));}
  function merge(a,p){p.matrix.forEach((r,y)=>r.forEach((v,x)=>{if(v)a[y+p.pos.y][x+p.pos.x]=v;}));}
  function collide(a,p){const m=p.matrix;for(let y=0;y<m.length;y++)for(let x=0;x<m[y].length;x++)if(m[y][x]&&(a[y+p.pos.y]&&a[y+p.pos.y][x+p.pos.x])!==0)return true;return false;}
  function rotate(m,d){for(let y=0;y<m.length;y++)for(let x=0;x<y;x++)[m[x][y],m[y][x]]=[m[y][x],m[x][y]];d>0?m.forEach(r=>r.reverse()):m.reverse();}
  function playerRotate(d){const pos=p.pos.x;let off=1;rotate(p.matrix,d);while(collide(arena,p)){p.pos.x+=off;off=-(off+(off>0?1:-1));if(Math.abs(off)>p.matrix[0].length){rotate(p.matrix,-d);p.pos.x=pos;return;}}}
  function playerDrop(){p.pos.y++;if(collide(arena,p)){p.pos.y--;merge(arena,p);sweep();spawn();}dropCounter=0;}
  function hardDrop(){while(!collide(arena,p))p.pos.y++;p.pos.y--;merge(arena,p);sweep();spawn();dropCounter=0;}
  function sweep(){let c=0;outer:for(let y=arena.length-1;y>=0;y--){for(let x=0;x<arena[y].length;x++)if(arena[y][x]===0)continue outer;arena.splice(y,1)[0].fill(0);arena.unshift(new Array(COLS).fill(0));c++;y++;}if(c){const pts=[0,40,100,300,1200];p.score+=pts[c]*level;totalLines+=c;level=Math.floor(totalLines/10)+1;dropInterval=Math.max(120,800-(level-1)*60);updateUI();}}
  function updateUI(){scoreEl.textContent=p.score;levelEl.textContent=level;linesEl.textContent=totalLines;}
  function spawn(){p.matrix=p.next||createPiece(rand(1,7));p.next=createPiece(rand(1,7));p.pos.y=0;p.pos.x=Math.floor((COLS-p.matrix[0].length)/2);if(collide(arena,p))reset();drawNext();}
  function reset(){arena=createMatrix(COLS,ROWS);p.score=0;totalLines=0;level=1;dropInterval=800;p.next=createPiece(rand(1,7));p.matrix=null;updateUI();spawn();}
  function createPiece(t){return TETROMINOS[t].map(r=>r.slice());}
  const rand=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
  function draw(){ctx.clearRect(0,0,canvas.width,canvas.height);for(let y=0;y<ROWS;y++)for(let x=0;x<COLS;x++){const v=arena[y][x];ctx.fillStyle=v?COLORS[v]:'rgba(255,255,255,0.02)';ctx.fillRect(x*CELL+1,y*CELL+1,CELL-2,CELL-2);}if(p.matrix)drawMatrix(p.matrix,p.pos);}
  function drawNext(){const s=4;nctx.clearRect(0,0,nextCanvas.width,nextCanvas.height);const scale=nextCanvas.width/(s*CELL),m=p.next||createPiece(1),padX=Math.floor((s-m[0].length)/2),padY=Math.floor((s-m.length)/2);nctx.fillStyle='rgba(255,255,255,0.02)';nctx.fillRect(0,0,nextCanvas.width,nextCanvas.height);m.forEach((r,y)=>r.forEach((v,x)=>{if(v){nctx.fillStyle=COLORS[v];const px=(x+padX)*CELL*scale,py=(y+padY)*CELL*scale,w=CELL*scale-2;nctx.fillRect(px+1,py+1,w,w);}}));}
  function update(t=0){if(isPaused){lastTime=t;requestAnimationFrame(update);return;}const d=t-lastTime;lastTime=t;dropCounter+=d;if(dropCounter>dropInterval)playerDrop();draw();requestAnimationFrame(update);}
  document.addEventListener('keydown',e=>{if(e.repeat)return;if(e.key==='ArrowLeft'){p.pos.x--;if(collide(arena,p))p.pos.x++;}else if(e.key==='ArrowRight'){p.pos.x++;if(collide(arena,p))p.pos.x--;}else if(e.key==='ArrowDown'){playerDrop();}else if(e.key==='ArrowUp'){playerRotate(1);}else if(e.code==='Space'){e.preventDefault();hardDrop();}else if(e.key==='p'||e.key==='P'){togglePause();}else if(e.key==='r'||e.key==='R'){reset();}});
  pauseBtn.addEventListener('click',togglePause);restartBtn.addEventListener('click',reset);
  function togglePause(){isPaused=!isPaused;pauseBtn.textContent=isPaused?'Resume (P)':'Pause (P)';if(!isPaused)lastTime=performance.now();}
  const p=player;
  function init(){canvas.width=COLS*CELL;canvas.height=ROWS*CELL;nextCanvas.width=CELL*4;nextCanvas.height=CELL*4;p.next=createPiece(rand(1,7));spawn();updateUI();requestAnimationFrame(update);}
  window.microTetris={
    left:()=>{p.pos.x--;if(collide(arena,p))p.pos.x++;},
    right:()=>{p.pos.x++;if(collide(arena,p))p.pos.x--;},
    rotate:()=>playerRotate(1),
    drop:()=>playerDrop(),
    reset
  };
  init();
})();
</script>
</body>
</html>
